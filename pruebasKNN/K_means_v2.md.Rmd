---
title: "K_means_v2"
output: html_document
---

Enlaces interesantes:
https://www.datanovia.com/en/lessons/k-means-clustering-in-r-algorith-and-practical-examples/
https://rpubs.com/Joaquin_AR/310338

```{r}
library(tm)
library(factoextra)
library(proxy)
library(ggpubr)

# Cargamos los tados
datos_train <- read.table("datos_train_preprocesado.csv", sep=",", comment.char="",quote = "\"", header=TRUE)
# Establecemos la semilla
set.seed(3)

# corpus = tm::Corpus(tm::VectorSource(datos_train$benefits_preprocesad))
# 
# # Creamos matriz de términos con las palabras de los comentarios. Entonces cada fila, va a estar formada por los comentarios, donde cada palabra es una columna
# tdm <- tm::DocumentTermMatrix(corpus)
# 
# # Utilizamos TF-DF para representar los comentarios de forma numerica
# # Y asi podemos calcular la distancia que hay entre ellos
# tdm.tfidf <- tm::weightTfIdf(tdm)
# tfidf.matrix <- as.matrix(tdm.tfidf)
# 
# dist.matrix = proxy::dist(tfidf.matrix, method = "cosine")
# 
# head(dist.matrix)
# 
# summary(dist.matrix)


datos_train2 = datos_train[c(2,8,9)]
#mat_dist <- dist(x = datos_train2, method = "euclidean")
#head(mat_dist)
#round(as.matrix(mat_dist)[1:5, 1:5], 2)
#mat_dist = as.matrix(mat_dist)
datos_train2 %>% drop_na()
datos_train2 <- na.omit(datos_train2 )
km.res <- kmeans(datos_train2, 4)

#km_clusters_6 <- kmeans(x = datos, centers = 6, nstart = 50)
#datos <- datos_train2 %>% mutate(cluster = km.res$cluster)
# p2 <- ggplot(data = datos) +
#       geom_point(size = 3) +
#       labs(title = "Kmenas con k=6") +
#       theme_bw() +
#       theme(legend.position = "none")
# ggarrange(p2)

#head(km.res)

# 9, 10 2

# rownames(datos_train2) = as.vector(datos_train$urlDrugName)


fviz_cluster(object = km.res, data = datos_train2, show.clust.cent = TRUE,
             ellipse.type = "euclid", star.plot = TRUE, repel = TRUE) +
  labs(title = "Resultados clustering K-means") +
  theme_bw() +
  theme(legend.position = "none")


# media_grupos <- matrix(rnorm(n = 8, mean = 0, sd = 4), nrow = 4, ncol = 2, dimnames = list(NULL, c("media_x", "media_y")))
# media_grupos <- as.data.frame(media_grupos)
# media_grupos <- media_grupos %>% mutate(grupo = c("a","b","c","d"))
# datos <- datos_train2 %>% mutate(cluster = km.res$cluster)



#datos <- datos %>% mutate(cluster = as.factor(cluster), grupo   = as.factor(grupo))

# ggplot(data = datos, aes(x = x, y = y, color = '')) +
#   geom_text(aes(label = cluster), size = 5) +
#   theme_bw() +
#   theme(legend.position = "none")




# resultados <- data.frame(ciudad  = names(km.res$cluster), cluster = as.factor(km.res$cluster)) %>% arrange(cluster)
# 
# library(igraph)
# library(tidygraph)
# library(ggraph)
# datos_graph <- graph_from_data_frame(d = resultados, directed = TRUE)
# datos_graph <- as_tbl_graph(datos_graph)
# 
# # Se añade información sobre a que cluster pertenece cada observacion
# datos_graph <- datos_graph %>%
#   activate(nodes) %>%
#   left_join(resultados, by = c("name" = "ciudad"))
# 
# ggraph(graph = datos_graph) +
#   geom_edge_link(alpha = 0.5) +
#   geom_node_point(aes(color = cluster)) +
#   geom_node_text(aes(label = name), repel = TRUE, alpha = 0.5, size = 3) +
#   labs(title = "Resultados clustering K-means") +
#   theme_graph()

```


