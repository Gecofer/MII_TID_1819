---
title: "arbolitos_de_andrea"
author: "Andrea Morales Garzón"
date: "29 de enero de 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}

library(rpart)
library(rpart.plot)
library(e1071)
library(nnet)
library("rattle")
library(dplyr)
library(tm)

datos_train = read.csv("datos_train_preprocesado.csv", stringsAsFactors = F)
datos_train$benefits_sin_numeros <-gsub("[0-9]+", "", datos_train$benefits_preprocesado)
datos_train <- datos_train[-c(17,2585),]
# x= "hola1"
# y = gsub('[0-9]+', "", x)
# print(y)

datos_test = read.csv("datos_test_preprocesado.csv", stringsAsFactors = F)
datos_test$benefits_sin_numeros <-gsub("[0-9]+", "", datos_test$benefits_preprocesado)

# He cambiado la línea con union a bind_rows pq no me iba en mi pc :(
datos_total <- bind_rows(datos_train,datos_test)

corpus = Corpus(VectorSource(datos_total$benefits_sin_numeros))

# Creamos matriz de términos con las palabras de los comentarios. Entonces cada fila, va a estar formada por los comentarios, donde cada palabra es una columna
tdm <- tm::DocumentTermMatrix(corpus)
tdm.tfidf <- tm::weightTfIdf(tdm)

reviews = as.data.frame(cbind(datos_total$effectivenessNumber, as.matrix(tdm.tfidf)))


preparado_train <- reviews[1:1500,]
preparado_test <- reviews[-(1:1000),]



# reviews = as.data.frame(cbind(mis_mini_datos_jeje$benefits_preprocesado, as.matrix(tdm.tfidf)))
```

```{r}
library("randomForest")

data_x = preparado_train[1:15,]
colnames(data_x) <- paste(colnames(data_x), "_c", sep = "")

output.forest <- randomForest(as.factor(V1_c) ~ . , data = data_x, replace = T,ntree=100)

output.forest

plot(output.forest)

```


```{r}
# Predicciones
mod_rf = predict(output.forest, newdata = preparado_test[-3], type="response")

# Fallo
y.falladas = sum(mod_rf!=preparado_test$effectivenessNumber)/length(preparado_test$effectivenessNumber)

print("Error en test:")
print(y.falladas)

```